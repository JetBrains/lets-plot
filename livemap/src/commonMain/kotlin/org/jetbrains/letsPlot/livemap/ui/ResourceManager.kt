/*
 * Copyright (c) 2019. JetBrains s.r.o.
 * Use of this source code is governed by the MIT license that can be found in the LICENSE file.
 */

package org.jetbrains.letsPlot.livemap.ui

import org.jetbrains.letsPlot.core.canvas.Canvas
import org.jetbrains.letsPlot.core.canvas.CanvasProvider

class ResourceManager(private val canvasProvider: CanvasProvider) {
    private val snapshotMap: MutableMap<String, Canvas.Snapshot> = HashMap()

    init {
        add(KEY_PLUS, BUTTON_PLUS)
        add(KEY_PLUS_DISABLED, BUTTON_PLUS_DISABLED)
        add(KEY_MINUS, BUTTON_MINUS)
        add(KEY_MINUS_DISABLED, BUTTON_MINUS_DISABLED)
        add(KEY_GET_CENTER, BUTTON_GET_CENTER)
        add(KEY_MAKE_GEOMETRY, BUTTON_MAKE_GEOMETRY)
        add(KEY_MAKE_GEOMETRY_ACTIVE, BUTTON_MAKE_GEOMETRY_ACTIVE)
        add(KEY_DROP_OPEN, BUTTON_DROP_OPEN)
        add(KEY_DROP_CLOSE, BUTTON_DROP_CLOSE)
        add(KEY_RESET_POSITION, BUTTON_RESET_POSITION)

    }

    private fun add(key: String, dataUrl: String): ResourceManager {
        canvasProvider.decodeDataImageUrl(dataUrl).onResult(
            { snapshot -> snapshotMap[key] = snapshot },
            { message -> error(message) })
        return this
    }

    operator fun get(key: String): Canvas.Snapshot {
        return snapshotMap[key]!!
    }

    fun isReady(): Boolean = listOf(
        KEY_PLUS,
        KEY_PLUS_DISABLED,
        KEY_MINUS,
        KEY_MINUS_DISABLED,
        KEY_GET_CENTER,
        KEY_MAKE_GEOMETRY,
        KEY_MAKE_GEOMETRY_ACTIVE,
        KEY_DROP_OPEN,
        KEY_DROP_CLOSE,
        KEY_RESET_POSITION,
    ).all { snapshotMap.containsKey(it) }

    companion object {
        const val KEY_PLUS = "img_plus"
        const val KEY_PLUS_DISABLED = "img_plus_disable"
        const val KEY_MINUS = "img_minus"
        const val KEY_MINUS_DISABLED = "img_minus_disable"
        const val KEY_GET_CENTER = "img_get_center"
        const val KEY_MAKE_GEOMETRY = "img_create_geometry"
        const val KEY_MAKE_GEOMETRY_ACTIVE = "img_create_geometry_active"
        const val KEY_DROP_OPEN = "img_drop_open"
        const val KEY_DROP_CLOSE = "img_drop_close"
        const val KEY_RESET_POSITION = "img_reset_position"

        private const val BUTTON_PLUS =
            ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB30lEQVRo3u3aQXKiQBQG4P91g1pugI0LdUHfIDnBODfxBpMjeAMzN9CTjDeY3AAWiEvRDRaWvFkknTGZxVQSNLZ5fxVVFCyor6B/CuoRnpIkSdhqte6I6Bszj+BGHpj5fjgczu0BAoDVahUz8y9mjuFm0qqqvhtjUgKAPM8TZo611oiiCL7vg4guXrHb7bDZbHA4HCzqVmdZNgYw1lqj1+vB8zwnMADgeR663S7KsgQzh1rrnSKiHwAQBIEzkOMopRCG4eP6IRopADcA0Ol04Gp83wcAMPNI4Qqi1F/GVYBe4AQkIAEJSEACEpCAPg80m80QRRGMMZjP5ycH0XK5ZADo9/snuYAxBmmaAgDCMMR6vT7JdfI8P88dshgAKIpC1pCABPSfNiOiF9s/LfTqfNPt11jLHbfZW9NE+zXech9pMPvX5qIeuel0ijiO34WZTCbuvFhfryNmdvvFKrUtoDODjhvsPaVxcSDbfk232ae13LkiLScgAQlIQAISkIC+MuhUX5JnBxHRAgCqqnIWUZal3X1QzLwAHv/auHiX6rrGdru1T9k9JUkSttvt33a8LAgCJ+Z+6rrGfr9HURTP42WDwcBc5wCgTZZl46dxsxsXFMy8IKJFVVU/jTEFAPwBy5fO64A7mu0AAAAASUVORK5CYII=")

        private const val BUTTON_MINUS =
            ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAABqElEQVRo3u3az23CMBQG8M92jCIucS4cIg7xBnSC0k3YoB2BDaAbwCRlg7JBcghwJHBJAPHcQ0n/HAtIxeh9kqUkkmP95CcfrCdwSpZlptVqvUgpH4moDz8yd86Nu93utPkgAGC1WqUA3ogohYcRQuS73e7JWps3oIyIUqUU4jiG1hpCiJuH1HWNzWaD4/HYoB5UURQDAAOlFDqdDoIg8AIDAEEQoN1uo6oqEJHRWtdSCPEMAFEUeQP5GSkljDHNa18C6AFAGIbwNVprAAAR9SXuIFJ+M+4C9AvHIAYxiEEMYhCDGMQgBjGIQQy6LJPJBHEcQwjxp2GtxXQ6vRpILBYLBwBJklz0I2st8jw/a64xBuv1+qL1l8vldXeoLMuz5/64tbmdkhuNRkjT9CzMcDi8vZL771y95PjYZhCDGMQgBjGIQQxiEIMYxKAbATnn7gMkpZwBwH6/9xZRVVXzOJcAZsDnrY2Pu0RE2G63TZWNRZZlJgzD96a9LIoiL/p+iAiHwwFlWX61lyVJYu+zAbBJURSDU7tZzweIc26mlJrVdf1qrS0B4AOUH6GK+nkhxwAAAABJRU5ErkJggg==")

        private const val BUTTON_MINUS_DISABLED =
            ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4wYTDA80Pt7fQwAAAaRJREFUaN7t2jFqAkEUBuB/xt1XiKwGwWqLbBBSWecEtltEG61yg+QCabyBrZU2Wm2jp0gn2McUCxJBcEUXdpQxRbIJadJo4WzeX07x4OPNNMMv8JX5fF4ioqcgCO4dx6nBgMRx/Or7fsd13UF6JgBgsVhcTyaTFyKqwMAopZb1ev3O87w3AQC9Xu+diCpSShQKBViWBSGECRDsdjtorVPUrQzD8CHFlEol2LZtBAYAiAjFYhFSShBRhYgec9VqNbBt+yrdjGkRQsCyLCRJgul0Wpb5fP4m1ZqaXC4HAHAcpyaRgUj5w8gE6BeOQQxiEIMYxCAGMYhBDGIQg/4p6CyfCMPhEKPR6KQZrVYL7Xb7MjZ0KuZcM/gN/XVdLmEGAIh+v38EgHK5bPRmVqsVXzkGMYhBDGIQgxjEIAYxiEEMyiToeDxmA7TZbGYAcDgcjEUkSQLgs24mG41GAADb7dbILWmtEccxAMD3/Y5USnWVUkutNdbrNZRSxkD2+z2iKPqul7muO8hmATBNGIYP4/H4OW1oXXqiKJo1m81AKdX1PG8NAB90n6KaLrmkCQAAAABJRU5ErkJggg==")

        private const val BUTTON_PLUS_DISABLED =
            ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4wYTDBAFolrR5wAAAdlJREFUaN7t2j9v2kAYBvDnDvsdEDJUSEwe6gipU+Z+AkZ7KCww5Rs0XyBLvkFWJrIckxf8KbohZS8dLKFGQsIILPlAR4fE/adEaiWScOh9JsuDrZ/v7hmsV+Axs9msQUSXcRx/8jzvHBYkz/OvURRd+75/W94TADCfz98nSfKFiFqwMFrr+06n8zEIgm8CAIbD4XciakkpUavV4DgOhBA2QLDZbGCMKVEfZJqmFyWm0WjAdV0rMABARKjX65BSgohaRPS50m63Y9d135UrY1uEEHAcB0VRYDqdNmW1Wj0rtbamUqkAADzPO5c4gUj5i3ESoD9wDGIQgxjEIAYxyCKQUgphGCIMQyil7AeNx+Mnr3nLMYhBDHqVHOQnglLqnxssDMMn7/f7fQwGg+NYoUPU8aEqnc/Qc9vlGJ4BAGI0Gu0BoNlsvsgX+/vMJEnyIu9ZLBa85RjEIAa9Aej3Oj5UNb9pbb9WuLYZxCAGMYhBDGLQf4D2+/1pgFar1R0A7HY7axFFUQB4GDeT3W43BoD1em3lKhljkOc5ACCKomuptb7RWt8bY7BcLqG1tgay3W6RZdnP8TLf929PcwCwTJqmF5PJ5Kqc0Dr2ZFl21+v1Yq31TRAESwD4AcX3uBFfeFCxAAAAAElFTkSuQmCC")

        private const val BUTTON_GET_CENTER =
            ("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH4wYcCCsV3DWWMQAAAc9JREFUaN7tmkGu2jAQhv+xE0BsEjYsgAW5Ae8Ej96EG7x3BHIDeoSepNyg3CAsQtgGNkFGeLp4hNcu2kIaXnE6vxQpika2P2Xs8YyGcFaSJGGr1XolomdmnsINrZh5MRqNvpQfCAC22+2Ymb8y8xhuam2M+RRF0ZoAIMuyhJnHWmv0ej34vg8ieniKw+GA3W6H0+lUQj3pNE1nAGZaa/T7fXie5wQMAHieh263i6IowMyh1vqgiOgFAIIgcAbkRymlEIbh2/4hmioAEwDodDpwVb7vAwCYearQACn1jtEIoJ/gBKgpQHEcg4iueuI4/vDxLjeFzWbDADAYDH5veOORzswfOl6WZbKHrtZ8Pq/Fpooqu9yfXOCvF3bjfOJyAiRAAiRAv4wb94ohdcx3dRx6dEkcEiABEiAB+n9qCrfk+FVVdb5KCR4RwVrbnATv3tmq7CEBEiAB+vdA965tV16X1LabWFOow7bu8aSmIMe2ANUM9Mg36JuAiGgJAMYYZyGKoihfV4qZlwCQ57mTf8lai/1+X3rZgpIkCdvt9reyvSwIAif6fqy1OB6PyPP80l42HA6jZjYAlkrTdHZuN5u4QMHMSyJaGmM+R1GUA8B3Hdvtjp1TGh0AAAAASUVORK5CYII=")


        private const val BUTTON_MAKE_GEOMETRY =
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAABqElEQVRo3u3az23CMBQG8M92jCIucS4cIg7xBnSC0k3YoB2BDaAbwCRlg7JBcghwJHBJAPHcQ0n/HAtIxeh9kqUkkmP95CcfrCdwSpZlptVqvUgpH4moDz8yd86Nu93utPkgAGC1WqUA3ogohYcRQuS73e7JWps3oIyIUqUU4jiG1hpCiJuH1HWNzWaD4/HYoB5UURQDAAOlFDqdDoIg8AIDAEEQoN1uo6oqEJHRWtdSCPEMAFEUeQP5GSkljDHNa18C6AFAGIbwNVprAAAR9SXuIFJ+M+4C9AvHIAYxiEEMYhCDGMQgBjGIQQy6LJPJBHEcQwjxp2GtxXQ6vRpILBYLBwBJklz0I2st8jw/a64xBuv1+qL1l8vldXeoLMuz5/64tbmdkhuNRkjT9CzMcDi8vZL771y95PjYZhCDGMQgBjGIQQxiEIMYxKAbATnn7gMkpZwBwH6/9xZRVVXzOJcAZsDnrY2Pu0RE2G63TZWNRZZlJgzD96a9LIoiL/p+iAiHwwFlWX61lyVJYu+zAbBJURSDU7tZzweIc26mlJrVdf1qrS0B4AOUH6GK+nkhxwAAAABJRU5ErkJggg=="

        private const val BUTTON_MAKE_GEOMETRY_ACTIVE =
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAACoElEQVRo3u2ZP2/TQBjGf+eYEJzUSI0aWqYWRAaQ6NIRhswsfAGGfoR+Ej4CEv0CWZgrASNLBkBqVOhQaJMoRUlI7PxxjiGldaImdWTH9lV5Vud09/N773OPLwLg3cHppi7kvhDsDIekUExCUBzI7t5uYetYXMCUpMREZQmajuxu6wkh30qJmUwZpDMmQgilOIZDh067Rc+2TF3c3deQvAYw0hnlYAA0LUE6Y14UiR3N/UDZ3SZGGENJSuOWaQkUd+lefmQk4flDuH8PdNcrOKxCuXb9mCdrkM9d/2zecWdN+F6BTi+AChlJePkYsulxmDC1bsKLR6O1+AZ6uh4diFt3EqNd4hvowUp8+sNMBdRDbn346u135dr0Ppln3Ktn41Va2vatt+3DarQLnHd+3cueXoSy6asmr7SmnzHzzq9H8dbzudEB6j4aylU4rCnYQ0ZyHOYyIeQgaygINOtcW0kpCHTrbHtWHqu0QrDtyf3ux/XyOdhcnW7PVt///LqXRQQBNOlsP+pgXwA0LDjvBDN/KLY9CTPreyj2PRQmzMKBwoZZKFAUMIH2kDubGclxNwsLJrC0PVkNrxcisUzb07LZf2v2W5l5x/vuoVnZzOoRupZZblJNe7HZLHSgevv6D7Np2UwJ2y5X4eTP6IbzpmwWOZDXtGv14Wc9+AXGNm37SRzzzL90ubjrxi03cEB33Sm775rD+n8o0Ao17Pi8/bNmAEClX6MqRa2+A9/OAgCy+vDxCCrN6EDqbfh05O2gFu8PfkuA1bUNpc3gvHa6tO0lUCRAmoYNIKVUFsJxrmxYk5IvAO2/jbEHqkhKidW+/PAq6gMp3uhClnq2ZfZsS9kqCUFzILt72m5h43ggxTZQVLJnBLaAzwPZ3d4tbB3/A6yfAztASEtoAAAAAElFTkSuQmCC"

        private const val BUTTON_DROP_OPEN =
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAAB2UlEQVRo3u3asY6qQBSA4R9niYmRCq2gsPYF1MIXsMXCGl9kXwRrK1tfwITwArYWYoc2BqMmhC02a9ybvffuLjObHTOnIoDkfJkDnpOMBZQAjuMwnU7p9/v0ej10iPV6TRRFLBaL2zkLKH3fZz6f43keOkaapkwmE3a73StotVrheR5CCNrtNvV6Hcuyfj3kdDqx3+8pioI0TRmNRoggCJ7H4zFCCHzfx7ZtLTAAtm3TbDbJ8xzHcbhcLtTCMATAdV1tIPchhKDVagEwGAywNptNCdDpdNA1iqJgu90CUOMBQghxO34I0H0YkAEZkAEZkAEZkAEZkL7xVOXH9/NTWZaVk5HxPGkrVHU4lDVcSi257yYlc1KuBPqoLL6a3Ef3VynfyitUBSUbI63kvoNSgZH6Dn0FpQoj/aPwGZRKjJI/1n+hVGOUdQqfLT/ZGKWtz/+SVYFR3sv9LWlVmB9pTv9MXiWmcnMqq/zM+GBABmRABmRABmRABmRA70A/2UAqBSVJAsD5fNYWkec58LrdrBbHMQBZlmm5SkVRcDgcAIiiCMtxnHK5XN62l7muS6PR0AJyvV7Jsuy2vWw4HD7oBsC3C0EQEIYh3W5XC0gcxyRJwmw243g8AvACMU7Fysb0rWMAAAAASUVORK5CYII="

        private const val BUTTON_DROP_CLOSE =
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAABt0lEQVRo3u3aMa6qQBTG8T8zl5gYp0IrKKzdgFq4AVssrHEjbyNYW9m6ARPCBmwtxA5tDEZNCLe4uca8vOpFRsfMVxFIgF8OkDnkOEAFoJRiNpsxGAzo9/uYkM1mQxzHLJfL+z4HqIIgYLFY4Ps+JibLMqbTKfv9/ge0Xq/xfR8pJZ1Oh0ajgeM4bw85n88cDgfKsiTLMsbjMTIMwz+TyQQpJUEQ4LquERgA13VptVoURYFSiuv1ioiiCADP84yBPEZKSbvdBmA4HOJst9sKoNvtYmrKsmS32wEg+IBIKe/bHwF6jAVZkAVZkAVZkAVZkAWZmy8dF3nss6qqMrtCfzeNdTeRQidGB0roxtSNErow/3p36kAJnRgdKKG7MnWjhO7HrG6U0I2pGyVegakTJV6FqQv11I/C/y5rnrkcEq/GPBv19Q438czz2X7IgizIgizIgizIgizoA0B1/9HUBkrTFIDL5WIsoigK4GfcTCRJAkCe50ZWqSxLjscjAHEc4yilqtVqdR8v8zyPZrNpBOR2u5Hn+X28bDQafegA4O+BMAyJooher2cEJEkS0jRlPp9zOp0A+AbKKLzZMpiYNQAAAABJRU5ErkJggg=="

        private const val BUTTON_RESET_POSITION =
            "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADQAAAA0CAYAAADFeBvrAAAACXBIWXMAAC4jAAAuIwF4pT92AAAExklEQVRoge1av0srSxT+ZjfqEgR/FBaJxa5gkcq7lWDzjIQUplD8B7QW4b5SEPzV2eWBiI3g6yVICkEQokVsBL0i2AgmRTYiBIxG0ET0e8U1+3ajXjfGGCN+MLCzM3vO+XbPzpxzGIFHJBKJ1sbGxr+FEH+R7Ed94BfJcGdn57/FGwIAzs7OVJIxkmrNTKsMyUKh4Nc0LSkAIJ1OJ0iqsiyjra0NDQ0NEELU2shXcXt7i8vLS9zf3wO/SelyKpUaAzAmyzI6OjrgcrnqggwAuFwuuN1u3NzcgGSrLMu3khDiJwC0tLTUDRErJElCa2srAEAI0S8B+AEAiqLU0q6K0NDQAAAg2S/V2JZ3gST9T+NLELLim1C5mJubgxACQgjMzc1VWx2EYRgEAI/HUx0FJSsnyaroSafTAL5d7vPDVQ2hu7u72NjYwO7u7pOxgYEB9PX1YXBwEH19fe+v3DAMGobB90AkEmEwGCQARy0YDDISibyL7iKPdyFkGAYnJiYcEyltExMT72KDYRis2OUODg4wPz+P9fV12/3m5ma0tbWhu7sbXV1dAIDT01OcnJzg4uIC19fX5tzFxUWkUilMT09D1/XKDKrkCxmGweHhYdvbdrvdHBoaYjQafVauYRiMRqMcGhqi2+22PTs8PFyRLRW7XKmbqarK5eVlR/IMw+Dy8jJVVX3ifm9BxYQikcgTMtFotGw50Wj0Cam3LBQVE7KuZu3t7VxbW7ON53I5LiwssLe3l4qiUFEU9vb2cmFhgblczjZ3bW2N7e3tttXvQwnF43HbGx0dHbXJ2NnZYSAQeHFVCwQC3NnZsRkzOjpqmxOPxz+O0NTUlKnY6/XalOdyuT+SsZKyfql4PE6v12uOT01NvYnQm0IfawTg8/mgqqrZX1pawtbW1qsytra2sLS0ZPZVVYXP53tWRzlwRMiaAgghEIvFzDFd122ReiQScazcOtfj8dj2oFgsZtPpOPVw4nIocRdZls3rlZUV21xFURxHCIqi2J5dWVl5VkexVc3lHutgnxKOCM3Ozr44dn5+buv39PQ4Vl461yqr9KX9yQYrHBGamZkBSbP5/X5zbG9vD4VCweyPjIw4Ulw6t1AoYG9vz+z7/X6bzpmZGUcy3+Ry1jzm8PAQyWTS7I+PjyMQCLwqIxAIYHx83Ownk0kcHh4+q6MsVLqxCiEYDoeZz+fN8XI31nw+z3A4TCFEbTZW0h76aJrGo6Mj23g5oc/R0RE1Tatd6EM+DU5DoRAzmUzZcjKZDEOhUO2DU9KePkiSxFAoxHQ6bXO/l5DP55lOpxkKhShJUu3Th6KQ0gTP5/NxdXWVmUzmWWL5fJ6ZTIarq6v0+XyfK8Ejyf39/SekhBDUdZ2Tk5Pc3Nzk8fExj4+Pubm5ycnJSeq6blsAimT29/ffbMeXLZJ8uTJWVWrb1kKjNTIHfkcA1Sg0Fmvb38X6z45vQuXCGvY7TQEqQdX/oY/C9z9ULzAJVWs5/WhIQohtALY0ut5wc3NTvPwlkdwGgGw2W5df6eHhAVdXVwAAkmGRSCRam5qaDvh4vKylpaUuzv08PDzg7u4O2WzWPF7m9Xq1r3kAsIhUKjX2eNzsR40MKwskt4UQ24VC4R9N07IA8B8rbUu9SU0MMQAAAABJRU5ErkJggg=="

    }
}
